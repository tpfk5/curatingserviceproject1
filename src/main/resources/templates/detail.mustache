<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <meta charset="UTF-8">
    <title>Detail</title>

    <style>
        html, body {
			height: 100vh;
			overflow: hidden;
		}


		/* 헤더 부분 */
		.top-header {
			position: fixed;
			top: 0;
			left: 0;
			width: 100vw;
			height: 104px;
			border-bottom: 1px solid #000;
			z-index: 1000;
			display: flex;
			flex-direction: column;

		}

		.header-row {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 0 32px;
			height: 80px;
			font-size: 16px;
			font-weight: 600;
            background-color: #000;
            color: white;
		}

		.header-menu {
			display: flex;
            grid-column: 2 / 4;
			gap: 24px;
			font-weight: 500;
            align-items: flex-start;
		}
        .list {
            font-size: 16px;
            font-weight: 600;
            border-right: 1px solid #000;
            display: flex;
        }

		.header-bar {
            height: 40px;
            border-top: 1px solid #000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            border-right: 1px solid #000;
		}

		.header-menu-link {
			text-decoration: none;
			font-weight: 600;
			font-size: 15px;
			padding: 0 8px;
		}


		/*메인 콘텐츠*/
		.main-content {
			display: grid;
			position: fixed;
			grid-template-columns: 500px 1fr 800px;
			top: 104px;
			bottom: 45px;
			left: 0;
			right: 0;
			border-top: 1px solid #000;
			overflow: hidden;
		}

		.left-section,
		.center-section,
		.image-section {
			overflow-y: auto;
			height: 100%;
			box-sizing: border-box;
		}

		/*왼쪽 구역*/
        .left-section {
            border-right: 1px solid #000;
			padding: 15px 20px;
            overflow-y: auto;
            box-sizing: border-box;
        }

		.exhibition-list {
			display: flex;
			flex-direction: column;
			border-top: 1px solid #000;
		}

		.exhibition-item {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 12px 8px;
			border-bottom: 1px solid #000;
			transition: background-color 0.2s;
			cursor: pointer;
		}

		.exhibition-item:hover {
			background-color: #f5f5f5;
		}

		.title-info {
			font-size: 15px;
			font-weight: 600;
			color: #111;
			flex: 1;
		}

		.period-info {
			font-size: 15px;
			font-weight: 400;
			min-width: 110px;
			text-align: right;
			color: #555;
		}


		/*중간 구역*/
		.center-section {
            border-right: 1px solid #000;
			padding: 20px 30px;
            overflow-y: auto;
            box-sizing: border-box;
        }


        .exhibition-description {
            font-size: 20px !important;
            text-align: justify !important;
            line-height: 1 !important;
			font-weight: 700 !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        .exhibition-description p {
            margin-bottom: 16px !important;
            font-size: 18px !important;
        }

        .exhibition-description span {
            font-size: inherit !important;
        }

		.exhibition-info {
			font-size: 18px;
			margin-top: 20px;
		}

        .exhibition-item.selected {
            background-color: #00FF00 !important;
        }

		.meta-info div {
			margin-bottom: 6px;
		}

		.meta-info strong {
			text-decoration: underline;
			text-underline-offset: 4px;
			margin-right: 6px;
		}


		/*이미지 구역 */
		.image-section {
            padding: 10px;
            overflow-y: auto;
            height: 100vh;
            box-sizing: border-box;
			align-items: flex-start;
			gap: 20px;
		}

		.exhibition-image {
			width: 100%;
            max-width: 500px;
			height: auto;
			object-fit: cover;
		}


		.btn {
			padding: 8px 16px;
			font-weight: 600;
			font-size: 14px;

		}

        /* 통계 구역*/
		.down-section {
			margin-top: 40px;
			max-width: 600px;
		}

		.stat-item {
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.stat-label {
			font-weight: bold;
		}


		/*푸터 구역*/
		.site-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100vw;
            height: 45px;
            border-top: 1px solid #000;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 0 24px;
            z-index: 1000;
            background-color: #000;
            color: white;
        }


            /*js*/
            .search-highlight {
                background-color: #fff3cd !important;
                border-left: 4px solid #ffc107 !important;
                font-weight: bold;
            }

            .exhibition-item.search-highlight:hover {
                background-color: #fff3cd !important;
            }


            .exhibition-item.selected.search-highlight {
                background-color: #d4edda !important;
                border-left: 4px solid #28a745 !important;
            }


    </style>
</head>
<body>
<!--HEADER-->
<!--전시 제목 구역-->
<header class="top-header">
	<div class="header-row">
		<span class="header-left" style="font-size: 20px";>{{TITLE}}</span>

        <!--버튼-->
		<div class="action-buttons">
			<a href="/main" class="btn"> GO BACK HOME</a>
		</div>
	</div>

		<div class="header-bar">
            <div class="list">Current Exhibitions List</div>

            <div class="header-menu">
                <span class="header-menu-link">2025</span>
                <span class="header-menu-link">detail info</span>
            </div>
        </div>
</header>


<div class="main-content">


    <!--왼쪽 -->
    <div class="left-section">

        <!--검색 구역-->
        <div class="search-container" style="margin-bottom: 20px; ">
            <div style="position: relative;">
                <input type="text" id="searchInput" class="search-box" placeholder="search exhibitions"
                       STYLE="width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid gray;"
                        onkeyup="filterExhibitions();">
            </div>
        </div>

        <!--전시 리스트 구역-->
    <div class="exhibition-list">
        {{#allExhibitions}}
            <a href="/detail?title={{title}}" class="exhibition-item" style="text-decoration: none; color: inherit;">
            <span class="title-info" style="font-size: 15px; flex: 1">{{title}}</span>
            <span class="period-info" style="font-size: 15px; min-width: 120px; margin-right: 15px">{{period}}</span>
            </a>
		{{/allExhibitions}}
			</div>
    </div>


	<!--중간 / 전시 설명 구역-->
    <section class="center-section">
            <div class="exhibition-description">{{{DESCRIPTION}}}</div>

	<!--중간 선-->
	    <div class="middle" style="	border-top: 1px solid #000000;
				margin: 10px 20px; "></div>


	<!--@@@수정해야함@@@-->
	<!-- 다운 섹션: 통계 ???-->
	<section class="down-section">
		<h2 class="stats-title">Taste Analystics</h2>
		<div class="stats-grid">
			<div class="stat-item">
				<div class="stat-label">Congestion Score</div>
				<span class="stat-number" id="congestionScore">{{scoreDetail.congestionScore}}</span>
			</div>

			<div class="stat-item">
				<div class="stat-label">Location Score</div>
				<span class="stat-number" id="locationScore">{{scoreDetail.locationScore}}</span>
			</div>

			<div class="stat-item">
				<div class="stat-label">Tag Score</div>
				<span class="stat-number" id="tagScore">{{scoreDetail.tagScore}}</span>
			</div>

			<!--추천 점수 & 이유-->
			<div class="recommendation-details" style="margin-top: 10px; font-weight: bold;">
				<div class="recommendation-score" id="recommenDScore"> Recommend Score: {{recommendScore}} </div>
				<div class="recommendation-text" id="recommendationText">@@@ Highly recommended @@@</div>
			</div>
		</div>

    </section>
</section>


	<!--우측 이미지 구역-->
	<section class="image-section">
		<div class="image-container">
			<img src="{{imageObject}}" class="exhibition-image" onerror="this.onerror=null; this.src='/img/temp.jpg';" >
		</div>

		<div class="exhibition-info">
			<div><strong>Author:</strong> {{AUTHOR}}</div>
			<div><strong>Institution:</strong> {{AGENCY}}</div>
			<div><strong>Period:</strong> {{PERIOD}}</div>
			<div><strong>congestion:</strong> {{congestionNm}}</div>
		</div>
	</section>

</div>


<!-- FOOTER (하단) -->
<footer class="site-footer">
	<span class="footer-code">20250901</span>
</footer>

</body>
<script>
    //전시 검색하기 (제목만)
    function filterExhibitions () {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const exhibitions = document.querySelectorAll('.exhibition-item');

        exhibitions.forEach(item => {
            const titleElement = item.querySelector('.title-info');
            const title = titleElement ? titleElement.textContent.toLocaleLowerCase() : '';

            if (title.includes(searchTerm) || searchTerm === '') {
				item.style.display = 'flex';

                if (searchTerm && title.includes(searchTerm)) {
					item.classList.add('search-highlight');
				} else {
					item.classList.remove('search-highlight');
				}
			} else {
                item.style.display = 'none'
			}
        });
    }

    // 현재 페이지의 전시 하이라이트 효과 주기
    document.addEventListener('DOMContentLoaded', function() {
        const currentTitle = document.querySelector('.header-left').textContent;
        const exhibitions = document.querySelectorAll('.exhibition-item');

        exhibitions.forEach(item => {
            const titleElement = item.querySelector('.title-info');
            if (titleElement && titleElement.textContent === currentTitle) {
                item.classList.add('selected');
            }
        });
    });


	//통계 부분
	async function updateRecommendations() {
		const preference = collectPreferences();
		console.log("전송할 데이터:", preference);

		//사용자 취향 저장하기
		try {
			const response = await fetch("/api/preference", {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify(preferences)
			});

			if (!response.ok) {
				console.error('서버 오류', response.status, await response.text());
				return;
			}

            //세션 ID  -> 업데이트 리스트 가져오기
			const cardsResponse = await fetch('/api/cards');
            const cards = await cardsResponse.json();

            console.log('받은 카드 데이터:', cards);
            updateCardDisplay(cards);

		} catch (error) {
            console.error('요청 실패', error)
	}
    }

</script>
</html>