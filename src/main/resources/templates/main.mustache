<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <meta charset="UTF-8">
    <title>Title</title>
    <style>
     html {
         font-family: 'Inter' ,sans-serif;
         margin: 0;
         height: 100%;
     }

     body {
         font-family: 'Inter' ,sans-serif;
         margin: 0;
     }

     .header {
         position: fixed;
         top: 0;
         left: 0;
         width: 100vw;
         height: 100px;
         z-index: 1000;
         display: flex;
         flex-direction: column;
     }
     .top-header {
         width: 100%;
         height: 100px;
         background-color: #000000;
         color: white;
         /*border-bottom: 1px solid #ddd;*/
         padding: 20px;
     }

     .header-row {
         display: flex;
         justify-content: space-between;
         align-items: center;
         height: 60px;
         font-size: 16px;
         font-weight: 600;
         background-color: #ffffff;
         padding: 20px;
         border-bottom: 1px solid #000000;
     }

    .main-container {
        display: grid;
        padding: 0 30px;
        margin: 0 auto;
        margin-top: 140px;

    }

    .top-section {
        background: #ffffff;
        color: #222;
        box-sizing: border-box;
    }

     .empty-section {
         margin-top: 40px;
         padding: 20px 0;
         background-color: #00FF00;
         border: 1px solid #000000;
     }


    .center-section {
        /*border-: 1px solid #000;*/
        /*padding: 30px;*/
        margin-bottom: 40px;
        /*grid-template-columns: 1fr 1fr 1fr*/
        grid-template-columns: repeat(3, 1fr);
    }

     .card {
         margin-bottom: 10px;
         position: relative;
     }

     .card-header {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: 16px;
     }
     .place, .congestion, .recomnd_score, .period {
         font-size: 18px;
         margin: 4px 0;
         font-weight: 400;
     }
     .cards-grid {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
         gap: 40px;
         /*margin-top: 20px;*/
         padding: 0 40px;
         box-sizing: border-box;
     }

     .badge {
         display: inline-block;
         padding: 4px 10px;
         border-radius: 10px;
         color: white;
         font-weight: bold;
         font-size: 7px;
     }
     .green{background-color: green}
     .orange{background-color: darkorange}
     .yellow{background-color: yellow; color: black;}
     .red{background-color: red}
     .gray{background-color: gray}


    .card-image {
        width: 100%;
        height: auto;
        margin-bottom: 25px;

        }
    .card-details {
        /*border-top: 1px solid #000;*/
        padding-top: 5px;
    }

     .detail-item {
         border-bottom: 1px solid #000;
         width: 100%;
     }

     .question-container {
         display: flex;
         gap: 60px;
         justify-content: space-between;
         margin-top: 40px;
     }
     .question-block {
         flex: 1;
         min-width: 200px;
         font-size: 18px;
     }
     .question {
         margin-bottom: 12px;
         font-weight: 600;
     }

     .answer .form-check {
         margin-bottom: 6px;
     }

     .titleandbtn {
         display: flex;
         align-items: center;
         margin-bottom: 30px;
     }


    .footer {
     background-color: #000;
     height: 60px;
     border-top: 1px solid #000;
     color: white;
    }
    </style>
</head>

<body>

<!--헤더-->
<div class="header">
    <div class="top-header"></div>
    <div class="header-row"> TESTING</div>
</div>

<!--본문-->
<div class="main-container">

    <!-- top 섹션 -->
<div class="top-section">
    <div>
        <h2>Selected Displays</h2>
        <div style="display: flex;">
    </div>

        <!--추천 전시 카드-->
        <div class="cards-grid" id="recommendationContainer">
        {{#cards}}
            <div class="card">
                <div class="card-header">
                <h5 style=" margin: 0; padding:0; font-size: 22px; ">{{title}}</h5>
                    <span class= "badge {{#isGreen}}green{{/isGreen}}{{#isOrange}}orange{{/isOrange}} {{#isYellow}}yellow{{/isYellow}}{{#isRed}}red{{/isRed}}{{#isGray}}gray{{/isGray}}"></span>

                <div class="action-buttons" style="padding: 8px 16px;
         text-decoration: none; font-weight: 600;font-size: 20px; ">
                <a href="/detail?title={{title}}" class="view-btn" > VIEW </a>
                </div>

                </div>
                <img src = "{{imageObject}}" class="card-image" loading="lazy">
                <div class="card-details"></div>
                <div class="detail-item">
                    <h5 class="place"> {{agencyNm}}</h5></div>
                <div class="detail-item">
                 <h5 class="recomnd_score"> 추천 {{recommendScore}}</h5> </div>
                <div class="detail-item">
                    <h5 class="period">{{period}}</h5></div>
            </div>
        {{/cards}}
        </div>
        </div>
    </div>

<!--    구역 나누기-->
    <section class="empty-section">
    </section>


<!--@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@-->
    <!-- 중간 섹션: 사용자 취향 분석 -->
    <div class="center-section">

        <!--{name} 이름 인풋 넣기????-->
        <div>
        <span class="test" style=" font-family: 'Intel', sans-serif; color: darkgray;">
              </span>
        </div>

        <div class="titleandbtn">
        <div class="sub-title">
            <h5 style="font-size: 40px;  margin: 0; padding: 0;">What are your tastes?</h5>
        </div>
        <button class="complete_input">IM READY!!!</button>
        </div>
        <div class="question-container">

        <!--첫번째 질문-->
        <div class="question-block">
        <div class="question1" style="font-size: 20px">
            1. Are there any museums you're interested in? </div>

        <div class="answer1">
        <div class="form-check">
            <input class="form-check-input" name="location" type="radio" value="서울" id="서울">
            <label class="form-check-label" for="서울">
                서울
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" name="location" type="radio" id="과천" value="과천" >
            <label class="form-check-label" for="과천">
               과천
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" name="location" type="radio" id="덕수궁" value="덕수궁" >
            <label class="form-check-label" for="덕수궁">
                덕수궁
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" name="location" type="radio" id="청주" value="청주">
            <label class="form-check-label" for="청주">
                청주
            </label>
        </div>
        </div>

</div>
        <!--두번째 질문(시간대)-->
            <div class="question-block">
        <div class="question2" style="font-size: 20px">
            2. When is the favorite time to visit the exhibition? </div>

        <div class="answer2" style="padding-top: 10px;">
        <div class="form-check">
            <input class="form-check-input" name="time" type="radio" value="MORNING" id="MORNING">
            <label class="form-check-label" for="MORNING">Morning</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" name="time" type="radio" id="AFTERNOON" value="AFTERNOON">
            <label class="form-check-label" for="AFTERNOON">Afternoon</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" name="time" type="radio" id="EVENING" value="EVENING" >
            <label class="form-check-label" for="EVENING">Evening</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" name="time" type="radio" id="ANY" value="ANY" >
            <label class="form-check-label" for="ANY">Any Time</label>
        </div>
    </div>
            </div>

        <!--세번째 질문(상설전 선택)-->
            <div class="question-block">
        <div class="question3" style="font-size: 20px">
            3. What kind of type of exhibition do you prefer? </div>

        <div class="answer3" style="padding-top: 10px;">
            <div class="form-check">
                <input class="form-check-input" name="type" type="radio"  value="상설전" id="상설전">
                <label class="form-check-label" for="상설전"> 자체 소장품 엄선한 미술관의 대표 전시 </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" name="type" type="radio" id="기획전" value="기획전">
                <label class="form-check-label" for="기획전"> 트렌디하고 주제가 있는 전시 </label>
            </div>
        </div>
        </div>
        </div>

    </div>
</div>
<footer class="footer">

</footer>
</body>
<script>
    // 버튼 누르면 업데이트 하기
    document.addEventListener('DOMContentLoaded', function() {
        const readyButton = document.querySelector('.complete_input');
        if (readyButton) {
            readyButton.addEventListener('click', function() {
                updateRecommendations();
            });
        }
    });


    async function updateRecommendations() {
        const preferences = collectPreferences();

        console.log('전송할 데이터:', preferences);

        try {

            const response = await fetch('/api/preference', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(preferences)
        });
            console.log('POST 응답:', response.status);


            if (!response.ok) {
            console.error('서버 오류:', response.status, await response.text());
            return;
        }

        //업데이트된 리스트!!!
        const cardsResponse = await fetch('/api/cards');
        const cards = await cardsResponse.json();

        updateCardDisplay(cards);
        } catch (error) {
            console.error('요청 실패:', error);
        }
    }

    function collectPreferences() {
        const getCheckedValues = (selector) =>
                Array.from(document.querySelectorAll(selector + ' input:checked'))
                        .map(el => el.value);

        return {
            preferredLocation: document.querySelector('input[name="location"]:checked')?.value || '',
            timePreference: document.querySelector('input[name="time"]:checked')?.value || null,
            preferredType: document.querySelector('input[name="type"]:checked')?.value || ''
        };
    }

    //취향 반영 카드 업데이트 하기
    function updateCardDisplay(cards) {
        console.log('updateCardDisplay 호출됨, 카드 개수:', cards.length);

        const container = document.getElementById('recommendationContainer');
        if (!container) return;

        container.innerHTML = '';

        //카드 개수 제한하기 (3개만)
        const limitedCards = cards.slice(0, 3);

        limitedCards.forEach(card => {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card';
            cardDiv.innerHTML = `
            <div class="card-header">
                <h5 style="margin: 0; font-size: 22px;">${card.title}</h5>
                <div class="action-buttons">
                    <a href="/detail?title=${card.title}" class="view-btn">VIEW</a>
                </div>
            </div>
            <img src="${card.imageObject}" class="card-image" loading="lazy">
            <div class="card-details">
                <div class="detail-item">
                    <h5 class="place">${card.agencyNm}</h5>
                </div>
                <div class="detail-item">
                    <h5 class="recomnd_score">추천 ${card.recommendScore}</h5>
                </div>
                <div class="detail-item">
                    <h5 class="period">${card.period}</h5>
                </div>
            </div>
        `;
            container.appendChild(cardDiv);
        });
    }






</script>

</html>