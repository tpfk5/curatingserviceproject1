<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <meta charset="UTF-8">
    <title>Title</title>
    <style>
     html {
         font-family: 'Inter' ,sans-serif;
         margin: 0;
         height: 100%;
     }

     body {
         font-family: 'Inter' ,sans-serif;
         margin: 0;
     }

     .header {
         position: fixed;
         top: 0;
         left: 0;
         width: 100vw;
         height: 100px;
         z-index: 1000;
         display: flex;
         flex-direction: column;
     }
     .top-header {
         width: 100%;
         height: 100px;
         background-color: #000000;
         color: white;
         padding: 20px;
     }

     .header-row {
         display: flex;
         justify-content: space-between;
         align-items: center;
         height: 60px;
         font-size: 16px;
         font-weight: 600;
         background-color: #ffffff;
         padding: 20px;
         border-bottom: 1px solid #000000;
     }

    .main-container {
        display: grid;
        margin: 0 auto;
        margin-top: 100px;

    }

    .top-section {
        background: #000000;
        color: #ffffff;
        box-sizing: border-box;
		padding-bottom: 30px;

    }

    .center-section {
		margin-top: 20px;
        margin-bottom: 40px;
        grid-template-columns: repeat(3, 1fr);
		padding: 0 30px;
	}

     .card {
		 position: relative;
		 overflow: hidden;
		 border-radius: 16px;
		 background: #ccc;
		 aspect-ratio: 2/3;
		 height: 100%;
		 margin: 0;
		 padding: 0;
     }

     .cards-grid {
         display: grid;
		 grid-template-columns: repeat(4, 1fr);
		 grid-template-rows: 1fr;
		 gap: 1px;
		 width: 100%;
		 max-width: 1400px;
		 margin: 0 auto;
		 height: 500px;
     }

	 .color-card {
		 position: relative;
		 height: 100%;
		 background-color: #ffffff;
		 display: flex;
		 align-items: center;
		 justify-content: center;
		 border-radius: 17px;
		 overflow: hidden;
		 aspect-ratio: 2/3;
	 }

	 .color-card-content {
		 text-align: center;
		 color: #000000;
		 font-size: 32px;
		 font-weight: 700;
		 letter-spacing: 2px;
	 }


	 .card-image {
		 width: 100%;
		 height: 100%;
		 object-fit: cover;
		 display: block;
		 transition: transform 0.3s ease;
	 }

	 .image-wrapper {
		 position: relative;
		 overflow: hidden;
		 height: 100%;
		 width: 100%;
		 border-radius: 17px;
		 margin: 0;
		 padding: 0;
	 }
	 .card-tags {
		 padding: 8px;
		 display:flex;
		 flex-wrap: wrap;
		 gap: 4px;
		 border-radius: 0 0 12px 12px;
	 }

	 .tag-badge {
		 display: inline-block;
		 padding: 2px 6px;
		 background: #f0f0f0;
		 color: #333;
		 font-size: 10px;
		 border-radius: 8px;
		 border: 1px solid #ddd;
	 }


	 .image-overlay {
		 position: absolute;
		 top: 0;
		 left: 0;
		 width: 100%;
		 height: 100%;
		 background-color: rgba(0, 0, 0, 0.3);
		 opacity: 0;
		 transition: opacity 0.3s ease;
	 }

	 .image-wrapper:hover .image-overlay {
		 opacity: 1;
	 }


     .question-container {
         display: flex;
         gap: 60px;
         justify-content: space-between;
         margin-top: 20px;
		 border-top: 1px solid #000
     }

	 .question-block {
		 padding-right: 20px;
		 margin-top: 30px;
	 }

	 .question-block.name-block {
		 display: flex;
		 align-items: center;
		 gap: 15px;
	 }

     .answer .form-check {
         margin-bottom: 6px;
     }

     .titleandbtn {
         display: flex;
         align-items: center;
         /*margin-bottom: 70px;*/
     }

	 .form-check-label{
		 font-size: 20px;
	 }


    .footer {
     background-color: #000;
     height: 60px;
     border-top: 1px solid #000;
     color: white;
    }

	 @media (max-width: 768px) {
		 .cards-grid {
			 grid-template-columns: repeat(2, 1fr);
		 }
	 }

    </style>
</head>

<body>

<!--헤더-->
<div class="header">
    <div class="top-header"></div>
    <div class="header-row"> HOME</div>
</div>

<!--본문-->
<div class="main-container">

    <!-- top 섹션 -->
<div class="top-section">
    <div>
		<h2 style="font-size: 40px; margin-top: 15px; padding: 0; ">
			Selected Displays for
			{{#userName}}{{userName}}{{/userName}}
			{{^userName}}TestUser{{/userName}}
		</h2>
        <div style="display: flex;">
    </div>

        <!--추천 전시 카드-->
        <div class="cards-grid" id="recommendationContainer">
        {{#cards}}
            <div class="card">
                <div class="card-header">
<!--                <h5 style=" font-size: 22px;">{title}</h5>-->
<!--                    <span class= "badge {#isGreen}green{/isGreen}{#isOrange}orange{/isOrange} {#isYellow}yellow{/isYellow}{#isRed}red{/isRed}}{#isGray}gray{/isGray}"></span>-->
<!--                <div class="action-buttons" style="padding: 8px 16px;-->
<!--         text-decoration: none; font-weight: 600;font-size: 20px; ">-->
<!--                <a href="/detail?title={title}" class="view-btn" > VIEW </a>-->
<!--                </div>-->
                </div>
				<div class="image-wrapper">
				<a href="/detail?title={{title}}">
                <img src = "{{imageObject}}" onerror="this.onerror=null; this.src='/img/temp.jpg';" class="card-image" loading="lazy">
					<div class="image-overlay"></div>
					</a>
				</div>
				<div class="card-tags">
					{{#tags}}
						<span class="tag-badge">{{.}}</span>
						{{/tags}}
				</div>
            </div>
        {{/cards}}
			<div class="color-card">
				<div class="color-card-content">NEW</div>
			</div>
        </div>
        </div>
    </div>

<!--    구역 나누기-->
<!--    <section class="empty-section">-->
<!--    </section>-->


<!--@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@-->
    <!-- 중간 섹션: 사용자 취향 분석 -->
    <div class="center-section">
        <div>
        <span class="test" style=" font-family: 'Intel', sans-serif; color: darkgray;">
              </span>
        </div>

        <div class="titleandbtn">'
        <div class="sub-title">
            <h5 style="font-size: 40px;  margin: 20px; margin-top: 7px;">What are your tastes?</h5>
        </div>
			<button class="complete_input" style="font-size: 20px" onclick="directSave()">IM READY!!!</button>
        </div>
        <div class="question-container">

        <!--첫번째 질문-->
        <div class="question-block name-block">
			<!--이름 적는 칸-->
			<div class="question0" style="font-size: 23px">
				0. What's u r name or nickname? </div>

			<div class="answer0" style="padding-top: 15px">
				<input type="text" id="userName" name="userName" placeholder="whatever name you want to be called"
					   style="width: 30%; padding: 20px; padding-left: 20px; border: 1px solid #000000; ">
			</div>

		<div class="question-block">
        <div class="question1" style="font-size: 23px; padding-top: 15px">
            1. Are there any museums you're interested in? </div>

        <div class="answer1" style="padding-top: 15px;">
        <div class="form-check">
            <input class="form-check-input" name="location" type="radio" value="서울" id="서울">
            <label class="form-check-label" for="서울">
                서울
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" name="location" type="radio" id="과천" value="과천" >
            <label class="form-check-label" for="과천">
               과천
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" name="location" type="radio" id="덕수궁" value="덕수궁" >
            <label class="form-check-label" for="덕수궁">
                덕수궁
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" name="location" type="radio" id="청주" value="청주">
            <label class="form-check-label" for="청주">
                청주
            </label>
        </div>
		<div class="form-check">
			<input class="form-check-input" name="location" type="radio" id="상관 없음" value="상관 없음">
			<label class="form-check-label" for="상관 없음">
				상관 없음
			</label>
		</div>
		</div>
        </div>

</div>
        <!--두번째 질문(태그 / 선택 사항)-->
            <div class="question-block">
        <div class="question2" style="font-size: 23px">
			2. What kind of art interests you? (다중 선택 가중) </div>

        <div class="answer2" style="padding-top: 15px;">
        <div class="form-check">
            <input class="form-check-input" name="tags" type="checkbox" value="설치/미디어" id="installation">
            <label class="form-check-label" for="installation">설치/미디어</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" name="tags" type="checkbox" id="photography" value="사진">
            <label class="form-check-label" for="photography">사진</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" name="tags" type="checkbox" id="painting" value="회화/수채" >
            <label class="form-check-label" for="painting">회화/수채</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" name="tags" type="checkbox" id="modern" value="근현대" >
            <label class="form-check-label" for="modern">근현대</label>
        </div>
		<div class="form-check">
			<input class="form-check-input" name="tags" type="checkbox" id="sound" value="사운드" >
			<label class="form-check-label" for="sound">사운드</label>
		</div>
		<div class="form-check">
			<input class="form-check-input" name="tags" type="checkbox" id="nature" value="자연" >
			<label class="form-check-label" for="nature">자연</label>
		</div>
		<div class="form-check">
			<input class="form-check-input" name="tags" type="checkbox" id="rookie" value="신인작가" >
			<label class="form-check-label" for="rookie">신인작가</label>
		</div>
		<div class="form-check">
			<input class="form-check-input" name="tags" type="checkbox" id="permanent" value="상설전" >
			<label class="form-check-label" for="permanent">상설전</label>
		</div>
		<div class="form-check">
			<input class="form-check-input" name="tags" type="checkbox" id="special" value="기획전" >
			<label class="form-check-label" for="special">기획전</label>
		</div>
    </div>
            </div>
        </div>

    </div>
</div>
<footer class="footer">

</footer>
</body>
<script>
    // 암 레디 버튼 누르면 업데이트 하기
    document.addEventListener('DOMContentLoaded', function() {
		console.log('$페이지 로드 완료');

        generateTagsOnce(); //태그 실행하기

        const readyButton = document.querySelector('.complete_input');
		console.log('$버튼 찾기 결과:', readyButton);

        if (readyButton) {
            readyButton.addEventListener('click', function() {
				console.log('$IM READY 버튼 클릭됨!');
                updateRecommendations();
            });
        }
    });

    async function generateTagsOnce() {
        try {
            const response = await fetch('/api/admin/generate-tags',{
                method: 'POST'
			});
            if (response.ok) {
                const date = await response.json();
                console.log("태그 생성 완료!:",date);
			}
		} catch (error) {
            console.log('태그 생성 중 오류 발생',error)
		}
	}

	function directSave() {
		console.log('직접 클릭 감지됨!');

        const preferences = collectPreferences();
        if (!preferences) {
            return;
		}

		fetch('/api/preference', {
			method: 'POST',
			headers: { 'Content-Type': 'application/json' },
			body: JSON.stringify({
				userName: preferences.userName,
				preferredLocation: preferences.preferredLocation,
				preferredTag: preferences.preferredTags
			})
		})
				.then(r => r.json())
				.then(data => {
					console.log('저장 성공:', data);
					alert('취향 저장 완료!');
					location.reload();
				})
				.catch(error => {
					console.error('저장 실패:', error);
					alert('저장 실패');
				});
	}


    function collectPreferences() {
		const userName = document.getElementById('userName').value || '';
		const preferredLocation = document.querySelector('input[name="location"]:checked')?.value || '';

        const selectedTags = Array.from(document.querySelectorAll('input[name="tags"]:checked'))
				.map(input => input.value);
        const preferredTags = selectedTags.join(',');


		console.log('$수집완료:', {
			userName: userName,
			location: preferredLocation,
			tags: preferredTags
		});

		if (!userName.trim()) {
			alert('이름을 입력하세요');
			return null;
		}

        if (!preferredLocation) {
			alert('모든 선택 사항을 체크해주세요');
			return null;
		}

        const result = {
            userName: userName,
			preferredLocation: preferredLocation,
			preferredTags: preferredTags
        };
        return result;
    }

</script>

</html>